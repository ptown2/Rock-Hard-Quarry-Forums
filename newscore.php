<?php
define('PUN_ROOT', './');require PUN_ROOT.'include/common.php';require PUN_ROOT.'cache/cache_games.php';if ($pun_user['is_guest'])
	message($lang_common['No permission']);
// Recover the game name and the score$game_name = (isset($_POST['game_name'])) ? $_POST['game_name'] : $_POST['gname'];$score = (isset($_POST['score'])) ? str_replace(" ", "", $_POST['score']) : $_POST['gscore'];if (!is_numeric($score))	message($lang_common['Bad request']);// This is a fix for var "score" which is sent as "Score" and not as "score" like in game "Easter Egg Catch"if (empty($score)){	$score = $_POST['Score'];	if (!is_numeric($score))		message($lang_common['Bad request']);}if (!empty($game_name) && !empty($score)) {	// Just to check incase any attempt to "html" cheat.	confirm_referrer('games.php');	session_start();		$sess_game_name = isset($_SESSION['game_name']) ? $_SESSION['game_name'] : '';		$sess_game_ratio = isset($_SESSION['game_ratio']) ? $_SESSION['game_ratio'] : 250;		if (strtolower($game_name) != strtolower(substr($_SESSION['game_name'], 0, strpos($_SESSION['game_name'], '.'))))			message('Stop trying to re-send the fucking score just to get rocks.');		$post_score = ceil($score / $sess_game_ratio);		if ($pun_user['rocks'] <= '9223372036854775807')			$db->query('UPDATE '.$db->prefix.'users SET rocks=rocks+'.$post_score.' WHERE id='.$pun_user['id']) or error('Unable to update user', __FILE__, __LINE__, $db->error());		else			$db->query('UPDATE '.$db->prefix.'users SET rocks=9223372036854775807 WHERE id='.$pun_user['id']) or error('Unable to update user', __FILE__, __LINE__, $db->error());				$_SESSION['game_name'] = null;		$_SESSION['game_ratio'] = null;	session_destroy();	redirect('games.php', 'You have earned '.$post_score.' rocks from playing this game!');
} else {
	message($lang_common['No permission']);
}
?>